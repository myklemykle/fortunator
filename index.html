<html>
<head>
	<script type="text/javascript">

		// https://stackoverflow.com/questions/805107/creating-multiline-strings-in-javascript
		// this is a gross hack I wouldn't use if i wasn't writing this for older browsers,
		// but i hope it makes the blocks of fortune text easier to edit. -m-

		function hereDoc(f) {
		return f.toString().
				replace(/^[^\/]+\/\*!?/, '').
				replace(/\*\/[^\/]+$/, '');
		}

// Below is all of the text used for fortunes -- the corpus.  
// Thanks to the magical hack (above), 
// all of the text between {/*! and */} can be edited in place
// without the need for any other funny javascript syntax.

		prompts = hereDoc(function() {/*!
Follow your heart to find {NOUN}
{NOUN} will guide you through the storm
A natural disaster will hit {NOUN}
Aliens will visit Earth and trade us {NOUN}
Competition will lead to {NOUN}
Girls do not like {NOUN} but they do like {NOUN}
Hopefully {NOUN} is not too important to you because it will go away
How does {NOUN} make you feel? Trust this intuition
I am unsure if {NOUN} investment is a good idea
I hope you don't think that I am immortal, because my gears will rust the same as {NOUN} will mold and {NOUN} evaporate
I see in my crystal ball a future of {NOUN}
I watched as {NOUN} collapsed and I will watch again
If you are running a business {NOUN} is the answer but avoid {NOUN} in the coming months
In the blurry vision of a ghost lost in time there appears a large quantity of {NOUN}. Do you trust it?
It is dangerous to be near {NOUN}
It is not clear whether this is good or bad news, but you will receive {NOUN}
Many more people will live their lives in virtual worlds
Nuclear weapons will be linked to {NOUN}
People in my country will become more tolerant of {NOUN}
People will have less {NOUN} than they did last year
Strict rules for {NOUN} will be introduced by the Government in my country
The Future of {NOUN} seems likely
The following things will change their position in your life {NOUN}, {NOUN} and {NOUN}.
The labor market will be saved by {NOUN}
The outcome of {NOUN} seems unfortunate
There are good things coming your way. Bad things as well. But {NOUN} is neither.
There are {NOUN} hiding in vast amounts somewhere
There is something in {NOUN} that will help you
There will be more {NOUN} in my country in the next year
There will be {NOUN} following you
We expect prices of {NOUN} in our countries to increase faster than our incomes
What you are looking for is less {NOUN}
What you are looking for is more {NOUN}
When will you ever stop thinking about {NOUN}?
You will find quiet contemplative solitude in {NOUN}
all in all you will live a happy life and the times of pain will bring you perspective, except for {NOUN}. That will only bring misery
anger will consume your {NOUN}
beyond the walls of your perception lie mountains of {NOUN} and seas of {NOUN}
burn your idols and plant {NOUN} on the scorched earth
certain events will effect {NOUN} in relation to {NOUN}
creation is destruction, such as {NOUN} is {NOUN}
crows will gather around {NOUN} and will they are distracted steal the {NOUN}
currently there are no foreseen optimal paths out of {NOUN} failure
expect to see stock markets and {NOUN} prices around the world crashing
find was to exploit your free time and will it with {NOUN}
hunger will force you to return to {NOUN}
hypergrowth will not disturb your {NOUN}
if you don't trust yourself then {NOUN} will never trust you
if you listen to the wind it will tell you to buy {NOUN}
if you love {NOUN} then you will be rewarded
if you never try {NOUN} you will never know {NOUN}
in the end there will only be {NOUN}
no matter how much {NOUN} you have it will not stop you from dying.
one day, you will realize that only {NOUN} was meant to be, everything else will fall into the abyss of time
our future is unimaginable because we have already imagined it. {NOUN} will be what we have never thought of
peace will find you in places of {NOUN}
personal choices will affect your success in {NOUN}
repetition in {NOUN} will certainly occur
search for {NOUN} in unknown spaces
some children wish for {NOUN}, others wish for {NOUN}, both are wrong
someone will help you find some {NOUN} you lost a long time ago
something will end in {NOUN}, others will begin in {NOUN}. Find your path.
the Garden Of Eden is fertilized with {NOUN}
the last thing you see before you die will be {NOUN}
the moon will shine a path in the night towards the tides that ebb in time and just as you reach the shore you will fall to your knees and kiss the ground. Buried beneath the sand you will find a treasure chest filled to the brim with {NOUN}
the price tag on {NOUN} is not set yet
the rich tapestries of {NOUN} will begin to unweave
the sky will fall on {NOUN}, and only {NOUN} will last
the spirit of {NOUN} will visit you the next solstice
there are certain things beyond my prediction capabilities, {NOUN} however is not outside of my vision
there are no answers to your questions, only {NOUN}
there is a certain wisdom in {NOUN} but don't confuse it with {NOUN}
there is a strong will in those around you to move toward a future of {NOUN}
there is an infinite amount of {NOUN} surrounding you at all times
there is no way to win in {NOUN}
there is no {NOUN} in your future
there is no {NOUN} in your past
there is not absolute truth, only {NOUN}
there will be no {NOUN} in heaven
there will be no {NOUN} in hell
things will never be as you have experienced them before, especially {NOUN}
to attract {NOUN} one must give {NOUN}
towers of {NOUN} will crumble while trees of {NOUN} will rise
trust your instincts about {NOUN}
try to change your habits concerning {NOUN}
when dealing with {NOUN} reason is more important than feelings
when you grow older you will realize that {NOUN} was all you needed
you are not sure of the truth but you do know {NOUN}
you do not have much time left, only {NOUN} will remain
you don't know what {NOUN} is
you where made in the mirror image of {NOUN}
you will find in the darkest of times {NOUN}
you will find it difficult to trust {NOUN} but have faith
you will never understand yourself or {NOUN}
your friends and loved ones will help you through a hard time and {NOUN} will be the rock that steadies your hands
{NOUN} fell behind today
{NOUN} is the true secret to happiness
{NOUN} will make you fall in love
{NOUN} will not haunt you again.
*/}).trim();

		nouns = hereDoc(function() {/*!
Crude oil
Coffee
Natural gas
Gold
Wheat
Cotton
Corn
Sugar
Silver
Copper
Rice
Palm oil
Wool
Amber
Rubber
Lead
Zinc
Tin
Aluminium
Nickel
Propane
Cobalt
Ethanol
Live cattle
Cocoa
Milk
Frozen Concentrated Orange Juice
Oats
Soybean oil
Soybeans
No 2 Soybean
Wind
Water
Sand
Air
Lakes
Rivers
Sky
Land
Earth
Sun
Snow
Fire
Ice
Rain
Steam
Clouds
NFTs
acceptance
adoration
affection
anticipation
bliss
calm
camaraderie
contempt
cruelty
denial
depression
desire
despair
disgust
emptiness
euphoria
fear
frustration
fulfillment
glee
gloom
grief
guilt
happiness
hope
humor
hurt
hysteria
infatuation
inner peace
innocence
insanity
inspiration
jealousy
joy
love
lust
melancholy
mercy
pain
paranoia
passion
pleasure
rage
regret
relief
remorse
shame
sincerity
*/}).trim();

		var corpus = {
			"MAIN": prompts.split('\n'),
			"NOUN": nouns.split('\n')
		};

		// Generate a random fortune from the corpus
		function pick(corpus, tag) {
			matcher=/\{[^\}\\]*\}/;

			//console.log("tag:" + tag);		//DEBUG
			if (! corpus[tag])
				return tag;

			// Pick an item out of the corpus:
			var item = corpus[tag][Math.floor(Math.random()*corpus[tag].length)];
			//console.log("item:" + item);		//DEBUG

			// If the item has any bracketed items like {NOUN}, 
			// fill those in using recursion.
			var match;
			while (match = item.match(matcher)) {
				//console.log("match:" + match[0]);		//DEBUG
				var subtag = match[0].slice(1,-1); // strip brackets
				//console.log("sub:" + subtag);		//DEBUG
				item = item.replace(match[0], pick(corpus, subtag).trim());
			}

			return item;
		}



		////////
		// Tell a random fortune, 
		// on screen & with speech:

		var tellFortune = function(event) {

			// Fix capitalization:
			// https://stackoverflow.com/questions/1026069/how-do-i-make-the-first-letter-of-a-string-uppercase-in-javascript
			function capitalizeFirstLetter(string) {
				return string.charAt(0).toUpperCase() + string.slice(1);
			}

			var hide = function(el){
				el.classList.remove("fadein");
				el.classList.add("fadeout");
			}
			var show = function(el){
				el.classList.remove("fadeout");
				el.classList.add("fadein");
			}

			resetTimer();
			// https://developer.mozilla.org/en-US/docs/Web/API/SpeechSynthesis
			var synth = window.speechSynthesis;
			if (! synth.speaking) { 

				els = {
					fortune: document.getElementById("fortune"),
					intro: document.getElementById("intro"),
				};

				var fortune = capitalizeFirstLetter(pick(corpus, "MAIN"));
				els.fortune.innerHTML = fortune;
				hide(els.intro);
				show(els.fortune);

				var finish = function(event) { 
					hide(els.fortune);
					show(els.intro);
					resetTimer();
					// flush key events?
				};

				var utterThis = new SpeechSynthesisUtterance(fortune);
				utterThis.addEventListener('end', finish);
				utterThis.addEventListener('error', finish);
				synth.speak(utterThis);

			}
		};

		document.onkeypress = tellFortune;
		document.onclick = tellFortune;

		///////////////
		// use a timer to occasionally tell a fortune when idle,
		// even if nobody interacts.
		// note that some browsers won't let this work unless someone has already interacted with the page at least once.

	  // https://stackoverflow.com/questions/667555/how-to-detect-idle-time-in-javascript
		var timer;

		function resetTimer() {
			clearTimeout(timer);
			// wait between 1 and 5 minutes before talking:
			var min = 1000 * 60 * 1; 
			var range = 1000 * 60 * 4; 
			var idletime = Math.floor(Math.random() * range + min);
				timer = setTimeout(tellFortune, idletime)
				// 1000 milliseconds = 1 second
		}

		window.addEventListener('load', resetTimer, true);
		var events = ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart'];
		events.forEach(function(name) {
		 document.addEventListener(name, resetTimer, true);
		});

	</script>
	<link rel="stylesheet" href="reset.css" />
	<style>
		<!-- https://www.w3schools.com/css/css_howto.asp -->

		@font-face {
			font-family: "Tamil Sangam";
			src:  local("Tamil Sangam MN"),
						local("TamilSangam-MN"),
						local("Arial Black"),
						local("Arial"),
						local("Helvetica"),
		}

		body, html {
			height: 100%;
		}

		.bg {
			background-image: url("loading-page-notext.jpg");
			/* background-image: url("loading-page.jpg"); */
			height: 100%;
			/* Center and scale the image nicely */
			background-position: center;
			background-repeat: no-repeat;
			background-size: cover;
		}

		.txt {
			/* font-family: "Tamil Sangam"; */
			font-family: "Arial Narrow",Arial,Helvetica,sans-serif;
			padding-top: 9%;
			text-align: center;
			font-size: 6em;
			-webkit-text-stroke: 0.03em white;
			transition: opacity 1s;
		}

		.intro {
			font-size: 6vw;
			opacity: 1;
		}

		.fortune {
			font-size: 5vw;
			font-weight: bold;
			position: absolute;
			top: 0;
			text-align: center;
			width: 80%;
			margin-left: 10%;
			margin-right: 10%;
			opacity: 0;
		}

		.fadeout {
			opacity: 0;
		}

		.fadein { 
			opacity: 1;
		}

	</style>
</head>
<body>
	<!-- <img src="loading-page.jpg" \> -->
	<div class="bg" />
	<h1 id="intro" class="txt intro"> 
		Press space for a reading
	</h1>
	<p id="fortune" class="txt fortune">
		Signs point to testing
	</p>
</body>
</html>

